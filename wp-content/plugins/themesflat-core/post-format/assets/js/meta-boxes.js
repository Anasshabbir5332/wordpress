(function($){"use strict";function togglePostFormatMetaBoxes(){var $input=$("input[name=post_format]"),$metaBoxes=$('#blog-options [id^="themesflat-options-control-"]').hide();if($("#post_type").val()=="members")return;if($("#post_type").val()=="food")return;$input.change(function(){$metaBoxes.hide();if($(this).val()=="gallery"||$(this).val()=="video"||$(this).val()=="audio"||$(this).val()=="quote"){$('[id*="themesflat-options-control-'+$(this).val()+'"]').show()}else $("#themesflat-options-control-blog_heading").show()});$input.filter(":checked").trigger("change");jQuery(document).on("change",'select[id*="post-format"]',function(){$metaBoxes.hide();if($(this).val()=="gallery"||$(this).val()=="video"||$(this).val()=="audio"||$(this).val()=="quote"){$('[id*="themesflat-options-control-'+$(this).val()+'"]').show()}else $("#themesflat-options-control-blog_heading").show()})}function SingleImagePicker(element){if($(element).length!=0){var frame,metaBox=$(element),addImgLink=metaBox.find("a.browse-media"),delImgLinks=metaBox.find("a.remove"),delImgLink=metaBox.find("a.themesflat-remove-media"),imgContainer=metaBox.find(".upload-preview"),imgIdInput=metaBox.find(".image-value");addImgLink.parent().show();var ids=[];addImgLink.on("click",function(event){var _root=$(this).parents("li");imgContainer=_root.find(".upload-preview"),imgIdInput=_root.find(".image-value");event.preventDefault();if(frame){frame.open();return}frame=wp.media({title:"Select or Upload Media Of Your Chosen Persuasion",button:{text:"Use this media"},multiple:false});frame.on("select",function(){var length=frame.state().get("selection").length;var images=frame.state().get("selection").models;var image_url;for(var iii=0;iii<length;iii++){image_url=images[iii].changed.url;imgContainer.html("");imgContainer.append('<li><img src="'+image_url+'" alt="" style="max-width:100%;"/><a href="#" id="'+images[iii].id+'" class="themesflat-remove-media" title="Remove"> <span class="dashicons dashicons-no-alt"></span> </a>');var image_caption=images[iii].changed.caption;var image_title=images[iii].changed.title}$(this).parent().hide();imgIdInput.val(image_url);delImgLink.show()});frame.open()});metaBox.on("click","a.themesflat-remove-media",function(event){event.preventDefault();var _root=$(this).parents("li");imgContainer=_root.find(".upload-preview"),addImgLink=_root.find("a.browse-media"),imgIdInput=_root.find(".image-value");addImgLink.parent().show();imgIdInput.val("");imgContainer.html("")});delImgLinks.on("click",function(event){var _root=$(this).parents("li");imgContainer=_root.find(".upload-preview"),imgIdInput=_root.find(".image-value");event.preventDefault();imgContainer.html("");addImgLink.parent().show();delImgLink.hide();imgIdInput.val("");ids=[]})}}function delimg($del_val,$array){var returnedData=$.grep($array,function($value){return $value!=$del_val});return returnedData}function ImagePicker(element){if($(element).length!=0){var frame,metaBox=$(element),addImgLink=metaBox.find("a.browse-media"),delImgLinks=metaBox.find("a.remove"),delImgLink=metaBox.find("a.themesflat-remove-media"),imgContainer=metaBox.find(".upload-preview"),imgIdInput=metaBox.find(".image-value");addImgLink.parent().show();var ids=[];addImgLink.on("click",function(event){event.preventDefault();if(frame){frame.open();return}frame=wp.media({title:"Select or Upload Media Of Your Chosen Persuasion",button:{text:"Use this media"},multiple:true});if(imgIdInput.val()!=""){ids=JSON.parse(imgIdInput.val())}frame.on("select",function(){var length=frame.state().get("selection").length;var images=frame.state().get("selection").models;for(var iii=0;iii<length;iii++){var image_url=images[iii].changed.sizes.thumbnail.url;imgContainer.append('<li><img src="'+image_url+'" alt="" style="max-width:100%;"/><a href="#" id="'+images[iii].id+'" class="themesflat-remove-media" title="Remove"> <span class="dashicons dashicons-no-alt"></span> </a>');var image_caption=images[iii].changed.caption;var image_title=images[iii].changed.title;ids.push(images[iii].id)}imgIdInput.val(JSON.stringify(ids));delImgLink.show()});frame.open()});metaBox.on("click","a.themesflat-remove-media",function(event){event.preventDefault();ids=JSON.parse(imgIdInput.val());$(this).parent().remove();ids=delimg($(this).attr("id"),ids);if(ids.length!=0){imgIdInput.val(JSON.stringify(ids))}else{addImgLink.parent().show();imgIdInput.val("")}});delImgLinks.on("click",function(event){event.preventDefault();imgContainer.html("");addImgLink.parent().show();delImgLink.hide();imgIdInput.val("");ids=[]})}}$(function(){togglePostFormatMetaBoxes();SingleImagePicker(".themesflat-options-control-single-image-control");ImagePicker(".themesflat-options-control-image-control")})})(jQuery);